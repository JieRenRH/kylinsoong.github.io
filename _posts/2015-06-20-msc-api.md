---
layout: blog
title:  "JBoss MSC API 介绍"
date:   2015-06-20 16:30:12
categories: jboss
author: Kylin Soong
duoshuoid: ksoong2015062001
excerpt: JBoss MSC(Modular Service Container) API 介绍  
---

[JBoss MSC](https://github.com/jboss-msc/jboss-msc) API 由三个部分组成:

* Injector 接口
* Value 接口
* Service 接口

本文按顺序从这三个方面介绍 [JBoss MSC](https://github.com/jboss-msc/jboss-msc) API。

## Injector 接口

**org.jboss.msc.inject.Injector** is a receiver for values that are injected from another source, typically connected to a service lifecycle. 它定义了两个方法:

* inject(T value) throws InjectionException - Inject the given value.
* uninject() - Uninject the given value (in other words, cancel or undo a previous injection).  Only called after `inject()` has been called.

### Injector 接口类图

![MSC Inject]({{ site.baseurl }}/assets/blog/msc-inject.png)

### Injector 接口示例

**示例.1** AtomicReferenceInjector<T> inject value to `java.util.concurrent.atomic.AtomicReference`

~~~
final AtomicReference<String> reference = new AtomicReference<String>();
final Injector<String> injector = new AtomicReferenceInjector<String>(reference);
injector.inject("Hello World");
System.out.println(reference.get());
injector.uninject();
~~~

运行如上代码 Console 端输出 String `Hello World`

**示例.2** FieldInjector<T> inject value to POJO class's file.

SimplePojo 有 public Field `description` 如下:

~~~
public class SimplePojo {

	public String description;
}
~~~

如下代码演示 FieldInjector<T> inject value to `description`:

~~~
final Field field = SimplePojo.class.getField("description");
final SimplePojo pojo = new SimplePojo();
final Injector<String> injector = new FieldInjector<String>(Values.immediateValue(pojo), field);
injector.inject("Injection of description field");
System.out.println(pojo.description);
injector.uninject();
~~~

运行如上代码 Console 端输出 String `Injection of description field`

**示例.3** MethodInjector<T> invokes a method

SimplePojo 有 public Method `testMethod`:

~~~
public void testMethod(String value) {
	System.out.println(value);
}
~~~

如下代码演示 MethodInjector invoke `testMethod`:

~~~
Value<SimplePojo> target = new ImmediateValue<>(new SimplePojo());
List<Value<String>> arguments =new ArrayList<>();
arguments.add(new ImmediateValue<String>("Hello World"));
final Injector<String> injector = new MethodInjector<String>(SimplePojo.class.getMethod("testMethod", String.class), target, Values.immediateValue("String"), arguments);
injector.inject(null);
~~~

运行如上代码 Console 端输出 String `Hello World`.

**示例.4** SetMethodInjector<T> call setter method

SimplePojo 有 public Method `setId`:

~~~
private Integer id;

public Integer getId() {
	return id;
}

public void setId(Integer id) {
	this.id = id;
}
~~~

如下代码演示 SetMethodInjector call `setId`:

~~~
Value<SimplePojo> target = new ImmediateValue<>(new SimplePojo());
Method method = SimplePojo.class.getMethod("setId", Integer.class);
final Injector<Integer> injector = SetMethodInjector.<Integer>create(target, method);
injector.inject(1000);
System.out.println(target.getValue().getId());
injector.uninject();
~~~

运行如上代码 Console 端输出 Integer `1000`.


**示例.5** CastingInjector<T> casts the value to a specific type

SimplePojo 有 public Field `listField`:

~~~
public List<String> listField;
~~~ 

如下代码演示 CastingInjector<T> casts the value to a specific type:

~~~
final Field field = SimplePojo.class.getField("listField");
List<String> list = new ArrayList<>();
SimplePojo pojo = new SimplePojo();
list.add("Hello World");
final Injector<List> fieldInjector = new FieldInjector<>(Values.immediateValue(pojo), field);
final Injector<Object> castingInjector = Injectors.cast(fieldInjector, List.class);
castingInjector.inject(list);
System.out.println(pojo.listField.get(0));
castingInjector.uninject();
~~~

运行如上代码 Console 端输出 String `Hello World`.
