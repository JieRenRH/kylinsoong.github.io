---
layout: blog
title:  "Java on top of LDAP"
date:   2014-11-08 16:20:00
categories: data
permalink: /ldap-java
author: Kylin Soong
duoshuoid: ksoong2014110801
---

This article demonstrates how java code operate Lightweight Directory Access Protocol(LDAP), we use OpenLDAP as a LDAP server, for completely install, admin, getting start OpenLDAP please refer to [OpenLDAP Admin Guide](http://www.openldap.org/doc/admin24/guide.html).

> Assume OpenLDAP installed on Server 10.66.218.46, the initial entries be added to directory, the following test base on this.

## JNDI Retrieve attributes

In this section we use `com.sun.jndi.ldap.LdapCtxFactory` initilize JDNI context, then lookup the entries we created before:

~~~
		Hashtable<String,String> env = new Hashtable<String,String>();
		env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
		env.put(Context.PROVIDER_URL, "ldap://10.66.218.46:389");
		env.put(Context.SECURITY_PRINCIPAL, "cn=Manager,dc=example,dc=com");
		env.put(Context.SECURITY_CREDENTIALS, "redhat");
		DirContext ctx = new InitialLdapContext(env, null);

		Attributes attrs = ctx.getAttributes("uid=kylin,ou=People,dc=example,dc=com");
~~~

## JNDI search attributes with SearchControl and filter

Continue using above JNDI context, the following code samples used to search attributes with SearchControl and filter:

~~~
		LdapContext context = (LdapContext) cxt.lookup("ou=People,dc=example,dc=com");
		
		SearchControls controls = new SearchControls();
		controls.setSearchScope(SearchControls.SUBTREE_SCOPE);
		controls.setTimeLimit(6);
		controls.setCountLimit(5);
		controls.setReturningAttributes(new String[]{"uid", "cn"});
		
		String filter = "(objectClass=*)";
		NamingEnumeration<SearchResult> en = context.search("", filter, controls);
		while(en.hasMoreElements()){
			SearchResult result = en.nextElement();
			System.out.println(result.getAttributes());
		}
~~~
